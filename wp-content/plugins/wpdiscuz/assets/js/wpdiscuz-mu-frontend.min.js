jQuery(document).ready(function(e){if(e(document).on("click","#wpdcom .wmu-upload-wrap",function(){e(".wpd-form-foot",e(this).parents(".wpd_comm_form")).slideDown(parseInt(wpdiscuzAjaxObj.enableDropAnimation)?500:0)}),e(document).on("change",".wmu-add-files",function(){var a=e(this),t=a.parents(".wpd_comm_form"),o=a[0].files?a[0].files:[];o.length&&function(a,t,o){var d=new FormData;d.append("action","wmuUploadFiles"),d.append("wmu_nonce",wpdiscuzAjaxObj.wmuSecurity),d.append("wmuAttachmentsData",e(".wmu-attachments-data",t).val());var i=0;e.each(o,function(e,a){i+=a.size,d.append(wpdiscuzAjaxObj.wmuInput+"["+e+"]",a)}),i>parseInt(wpdiscuzAjaxObj.wmuMaxFileSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.wmuPhraseMaxFileSize,"error",3e3):i>parseInt(wpdiscuzAjaxObj.wmuPostMaxSize)?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj.wmuPhrasePostMaxSize,"error",3e3):wpdiscuzAjaxObj.getAjaxObj(!0,!0,d).done(function(a){a.success?(e(".wmu-attached-data-info",t).remove(),e(".wmu-add-files",t).after(a.data.attachmentsHtml),a.data.tooltip&&e(".wmu-upload-wrap").attr("wpd-tooltip",a.data.tooltip),function(a,t){e.each(t.data.previewsData,function(t,o){e(".wmu-action-wrap .wmu-"+t+"-tab",a).html(""),e.each(o,function(o,d){var i=d.id,m="",s=d.fullname,u=d.shortname;t==wpdiscuzAjaxObj.wmuKeyImages?(m=d.url,u=""):t==wpdiscuzAjaxObj.wmuKeyVideos?m=wpdiscuzAjaxObj.wmuIconVideo:t==wpdiscuzAjaxObj.wmuKeyFiles&&(m=wpdiscuzAjaxObj.wmuIconFile);var r='<div class="wmu-preview [PREVIEW_TYPE_CLASS]" title="[PREVIEW_TITLE]" data-wmu-type="[PREVIEW_TYPE]" data-wmu-attachment="[PREVIEW_ID]"><div class="wmu-preview-remove"><img class="wmu-preview-img" src="[PREVIEW_ICON]"><div class="wmu-file-name">[PREVIEW_FILENAME]</div><div class="wmu-delete">&nbsp;</div></div></div>';r=(r=(r=(r=(r=(r=r.replace("[PREVIEW_TYPE_CLASS]","wmu-preview-"+t)).replace("[PREVIEW_TITLE]",s)).replace("[PREVIEW_TYPE]",t)).replace("[PREVIEW_ID]",i)).replace("[PREVIEW_ICON]",m)).replace("[PREVIEW_FILENAME]",u),e(".wmu-action-wrap .wmu-"+t+"-tab",a).removeClass("wmu-hide").append(r)})})}(t,a),a.data.errors&&(wpdiscuzAjaxObj.setCommentMessage(a.data.errors,"error",3e3),console.log(a.data.errors))):a.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj[a.data.errorCode],"error",3e3):a.data.error&&wpdiscuzAjaxObj.setCommentMessage(a.data.error,"error",3e3),e("#wpdiscuz-loading-bar").fadeOut(250)}).fail(function(a,t,o){console.log(o),e("#wpdiscuz-loading-bar").fadeOut(250)})}(0,t,o)}),e(document).on("click",".wmu-attachment-delete",function(a){if(confirm(wpdiscuzAjaxObj.wmuPhraseConfirmDelete)){var t=e(this).data("wmu-attachment"),o=new FormData;o.append("action","wmuDeleteAttachment"),o.append("wmu_nonce",wpdiscuzAjaxObj.wmuSecurity),o.append("attachmentId",t),wpdiscuzAjaxObj.getAjaxObj(!0,!0,o).done(function(a){if(a.success){var o=e(".wmu-attachment-"+t).parents(".wmu-comment-attachments");e(".wmu-attachment-"+t).remove(),e(".wmu-attached-images *",o).length||e(".wmu-attached-images",o).remove(),e(".wmu-attached-videos *",o).length||e(".wmu-attached-videos",o).remove(),e(".wmu-attached-files *",o).length||e(".wmu-attached-files",o).remove()}else a.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj[a.data.errorCode],"error",3e3):a.data.error&&wpdiscuzAjaxObj.setCommentMessage(a.data.error,"error",3e3);e("#wpdiscuz-loading-bar").fadeOut(250)}).fail(function(a,t,o){console.log(o),e("#wpdiscuz-loading-bar").fadeOut(250)})}else console.log("canceled")}),e(document).on("click",".wmu-preview",function(){var a=e(this),t=a.parents(".wpd_comm_form"),o=(a.data("wmu-type"),a.data("wmu-attachment")),d=new FormData;d.append("action","wmuRemoveAttachmentPreview"),d.append("attachmentId",o),d.append("wmu_nonce",wpdiscuzAjaxObj.wmuSecurity),d.append("wmuAttachmentsData",e(".wmu-attachments-data",t).val()),wpdiscuzAjaxObj.getAjaxObj(!0,!0,d).done(function(o){if(o.success){a.remove();var d=e(".wmu-tabs",t);e.each(d,function(a,t){e(".wmu-preview",t).length?e(t).removeClass("wmu-hide"):e(t).addClass("wmu-hide")}),e(".wmu-attached-data-info",t).remove(),e(".wmu-add-files",t).after(o.data.attachmentsHtml),o.data.tooltip&&e(".wmu-upload-wrap").attr("wpd-tooltip",o.data.tooltip)}else o.data.errorCode?wpdiscuzAjaxObj.setCommentMessage(wpdiscuzAjaxObj[o.data.errorCode],"error",3e3):o.data.error&&wpdiscuzAjaxObj.setCommentMessage(o.data.error,"error",3e3);e("#wpdiscuz-loading-bar").fadeOut(250)}).fail(function(a,t,o){console.log(o),e("#wpdiscuz-loading-bar").fadeOut(250)})}),parseInt(wpdiscuzAjaxObj.wmuIsLightbox)){function a(){e(".wmu-lightbox").colorbox({maxHeight:"95%",maxWidth:"95%",rel:"wmu-lightbox",fixed:!0})}a(),wpdiscuzAjaxObj.wmuAddLightBox=a}wpdiscuzAjaxObj.wmuHideAll=function(a,t){"object"==typeof a?a.success?(e(".wmu-tabs",t).addClass("wmu-hide"),e(".wmu-preview",t).remove(),e(".wmu-attached-data-info",t).remove()):console.log(a.data):console.log(a)}});